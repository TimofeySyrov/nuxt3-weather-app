import{L as M,M as b,m as U,r as v,l as F,d as P,o as A,N as W,t as u,v as f,x as r,O as H,P as K,Q as i,R as N,S,T as R,y,U as D,_ as k,z as L,C as V,D as j,c as C,G as Y,V as x}from"./entry.CPtiJl-c.js";const q="$s";function G(...t){const n=typeof t[t.length-1]=="string"?t.pop():void 0;typeof t[0]!="string"&&t.unshift(n);const[e,o]=t;if(!e||typeof e!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+e);if(o!==void 0&&typeof o!="function")throw new Error("[nuxt] [useState] init must be a function: "+o);const s=q+e,a=U(),c=M(a.payload.state,s);if(c.value===void 0&&o){const l=o();if(b(l))return a.payload.state[s]=l,l;c.value=l}return c}function B(){const t=G("coords",()=>null);return{coords:t,setCoords:e=>{t.value=e}}}function z(){const t=F(),n=v(null);let e=v(!1);async function o(s){e.value=!0;try{const a=await fetch(t.public.GEOAPIFY_API_URL+`?text=${s}&format=json&apiKey=${t.public.GEOAPIFY_API_KEY}`).finally(()=>{e.value=!1});if(!a.ok)throw new Error("Network response was not ok");n.value=await a.json()}catch(a){console.error("Error fetching data:",a)}}return{data:n,pending:e,fetchData:o}}const Q=(t,n)=>{let e;return(...o)=>new Promise(s=>{e&&clearTimeout(e),e=setTimeout(()=>s(t(...o)),n)})},J={class:"input-wrapper"},X={key:0,class:"suggestions"},Z=["onClick"],ee={key:0},te=P({__name:"SearchBar",setup(t){const n=v(""),e=v(!1),o=v(null),{setCoords:s}=B(),{data:a,fetchData:c}=z(),l=Q(()=>{if(n.value.length===0){e.value=!1;return}c(n.value).finally(()=>{e.value=!0})},600);function _(h){n.value=h.formatted,e.value=!1,s({lat:h.lat,lon:h.lon})}function d(){n.value.length>0&&!e.value&&(e.value=!0)}function p(h){o.value&&n.value.length>0&&(e.value=o.value.contains(h.target))}return A(()=>{document.addEventListener("click",p)}),W(()=>{document.removeEventListener("click",p)}),(h,m)=>{var w,$,E;return u(),f("div",{class:"bar",ref_key:"barElementRef",ref:o},[r("div",J,[H(r("input",{class:N(["input",{expanded:i(e)}]),type:"text","onUpdate:modelValue":m[0]||(m[0]=g=>b(n)?n.value=g:null),onInput:m[1]||(m[1]=(...g)=>i(l)&&i(l)(...g)),placeholder:"Search city"},null,34),[[K,i(n)]]),i(e)?(u(),f("div",X,[r("ul",null,[(u(!0),f(S,null,R((w=i(a))==null?void 0:w.results,(g,T)=>(u(),f("li",{key:T,onClick:Ne=>_(g)},y(g.formatted),9,Z))),128)),(E=($=i(a))==null?void 0:$.results)!=null&&E.length?D("",!0):(u(),f("li",ee,"Not found."))])])):D("",!0)]),r("button",{class:"btn",type:"button",onClick:d},"Search")],512)}}}),ne=k(te,[["__scopeId","data-v-6906a27b"]]),oe={},ae={class:"header"};function se(t,n){const e=ne;return u(),f("header",ae,[L(e)])}const ce=k(oe,[["render",se],["__scopeId","data-v-012bc1d5"]]);function O(t){return`${F().public.OPENWEATHERMAP_ICON_URL}${t}@2x.png`}function I(t){const n=new Date(t),e=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${e}-${o}-${s}`}const re={props:{weather:{type:Object,required:!0}},methods:{formatDate(t){const e=new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit"}).format(t);let o=t.getHours();const s=("0"+t.getMinutes()).slice(-2),a=o>=12?"pm":"am";o=o%12||12;const c=`${o}:${s}${a}`;return`${e}, ${c}`}}},ie={class:"card"},le={class:"location"},ue={class:"date"},de={class:"city"},_e={class:"temp"},fe=["src"],he={class:"other"};function pe(t,n,e,o,s,a){return u(),f("div",ie,[r("div",le,[r("div",ue,y(a.formatDate(new Date(e.weather.date))),1),r("div",de,y(e.weather.city),1)]),r("div",_e,[r("img",{src:("getWeatherIcon"in t?t.getWeatherIcon:i(O))(e.weather.iconCode),alt:"weather icon"},null,8,fe),r("div",null,y(e.weather.temp)+"°C",1)]),r("div",he,[r("div",null,"Humidity: "+y(e.weather.humidity)+"%",1),r("div",null,"Wind: "+y(e.weather.wind)+" km/h",1)])])}const me=k(re,[["render",pe],["__scopeId","data-v-01d839ef"]]),ye={props:{selectedDate:{type:String,required:!0},weather:{type:Object,required:!0}},methods:{handleCardClick(t,n){this.$emit("forecast-select",n)}}},ve=t=>(V("data-v-a6b56447"),t=t(),j(),t),we={class:"section"},ge=ve(()=>r("h2",{class:"title"},"4-day forecast",-1)),De={class:"forecast"},$e=["onClick"],ke={class:"weekday"},Ce=["src"];function Fe(t,n,e,o,s,a){return u(),f("section",we,[ge,r("ul",De,[(u(!0),f(S,null,R(e.weather,(c,l)=>(u(),f("li",{key:l,class:N({active:e.selectedDate===l}),onClick:_=>a.handleCardClick(_,`${l}`)},[r("div",ke,y(c.weekday),1),r("img",{src:("getWeatherIcon"in t?t.getWeatherIcon:i(O))(c.iconCode),alt:"weather icon"},null,8,Ce),r("div",null,y(c.temp)+" °C",1)],10,$e))),128))])])}const Se=k(ye,[["render",Fe],["__scopeId","data-v-a6b56447"]]);function Ee(){const t=F(),n=v(null);let e=v(!1);async function o({position:s,weatherUnits:a}){e.value=!0;try{const c=await fetch(t.public.OPENWEATHERMAP_API_URL+`?lat=${s.lat}&lon=${s.lon}&appid=${t.public.OPENWEATHERMAP_API_KEY}&units=${a}`).finally(()=>{e.value=!1});if(!c.ok)throw new Error("Network response was not ok");n.value=await c.json()}catch(c){console.error("Error fetching data:",c)}}return{data:n,pending:e,fetchData:o}}function xe(t){const n={};return t==null||t.forEach(e=>{const o=e.dt_txt.split(" ")[0];o in n||(n[o]=[]),n[o].push(e)}),n}function Ie(t,n){return t.map(e=>({city:n,date:e.dt_txt,weekday:new Date(e.dt_txt).toLocaleDateString("en-US",{weekday:"long"}),iconCode:e.weather[0].icon,temp:Math.round(e.main.temp),humidity:e.main.humidity,wind:e.wind.speed}))}function be(t){const n=new Date,e=v(I(n)),o=3,s=C(()=>xe(t.value.list)),a=C(()=>{const _={};for(let d=0;d<=o;d++){const p=new Date(n);p.setDate(n.getDate()+d);const h=I(p);_[h]=Ie(s.value[h],t.value.city.name).filter(m=>{const w=d===0,$=m.date.split(" ")[1]==="12:00:00";if(w||$)return m})[0]}return _});return{todayForecast:C(()=>a.value[e.value]),threeDaysForecast:a,selectedDate:e,updateSelectedDate:_=>{e.value=_}}}const Pe={class:"app"},Ae={key:0},Le=P({__name:"index",setup(t){const{coords:n}=B(),{data:e,fetchData:o}=Ee(),{todayForecast:s,threeDaysForecast:a,selectedDate:c,updateSelectedDate:l}=be(e);function _(d){o({position:d,weatherUnits:"metric"})}return A(()=>{const d={lat:51.509865,lon:-.118092};navigator.geolocation.getCurrentPosition(({coords:p})=>{_({lat:p.latitude,lon:p.longitude})},()=>{_(d)})}),Y(()=>n,d=>{n.value&&_(d.value)},{deep:!0,immediate:!0}),(d,p)=>{const h=ce,m=me,w=Se;return u(),f(S,null,[L(h),r("div",Pe,[i(e)?D("",!0):(u(),f("div",Ae,"Loading...")),i(e)?(u(),x(m,{key:1,weather:i(s)},null,8,["weather"])):D("",!0),i(e)?(u(),x(w,{key:2,selectedDate:i(c),onForecastSelect:i(l),weather:i(a)},null,8,["selectedDate","onForecastSelect","weather"])):D("",!0)])],64)}}});export{Le as default};
